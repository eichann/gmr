.container
  .row
    .col-xs-12.col-sm-12.col-md-12
      h1.main-title
        | On-Air
        span.bata 
          | (Î±)
      .request_message_box
        p.request_message Thank you for your request :)
      .form-wrap
        = render :partial => "common/form"
      .yt-set.clearfix
        #player
        .controll-box
          #start
            i.fa.fa-play.fa-4x style="color: white; margin-top: 21px;"
  javascript:
    var player;
    num = 0;
    ary = #{@impressions.to_json.html_safe};

    function shuffle(ary) {
    var n = ary.length, t, i;

    while (n) {
      i = Math.floor(Math.random() * n--);
      t = ary[n];
      ary[n] = ary[i];
      ary[i] = t;
    }

    return ary;
    }

    function onYouTubeIframeAPIReady(){
      var event = 'ontouchstart' in window ? 'touchend' : 'click';
      player = new YT.Player('player', {
        height: 200,
        width: 350,
        events: {
          onStateChange: onPlayerStateChange,
          onError: onPlayerError
        }
      });

      $(document).on(event, 'div#start', function(){
        if (#{@all_count} == num) {
          num = 0;
          shuffle(ary)
        };
        player.loadVideoById(ary[num]);
        num += 1
      });
    }


    function onPlayerStateChange(e) {
      if (e.data == YT.PlayerState.ENDED) {
        if (#{@all_count} == num) {
          num = 0;
          shuffle(ary)
        };
        player.loadVideoById(ary[num]);
        num += 1
        player.playVideo();
      }
    }

    function onPlayerError(e) {
      num += 1
      player.loadVideoById(ary[num]);
      num += 1
      player.playVideo();
    };
